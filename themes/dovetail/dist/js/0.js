(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,s){"use strict";t.a={list:function(){return"/api/v1/customers"},owned:function(){return"/api/v1/customers/owned"},store:function(){return"/api/v1/customers"},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/".concat(e)},restore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/restore/".concat(e)},update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/".concat(e)},trashed:function(){return"/api/v1/customers/trashed"},destroy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/".concat(e)},delete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/delete/".concat(e)},overall:function(e,t,s){return"/api/v1/reports/overall/customer/".concat(e,"/user/").concat(t,"?month=").concat(s)},indices:{list:function(){return"/api/v1/indices"}},surveys:{submit:function(e){return"/api/v1/surveys/".concat(e,"/submit")},show:function(e){return"/api/v1/surveys/".concat(e)}},crm:{search:function(e){return"/api/v1/crm/customers/search/".concat(e)},update:function(){return"/api/v1/crm/customers/update"},save:function(){return"/api/v1/crm/customers/save"},sendDocument:function(){return"/api/v1/crm/report/send"},sendFinancial:function(){return"/api/v1/crm/financial/send"}},reports:{list:function(e){return"/api/v1/customers/".concat(e,"/reports")},generate:function(e){return"/api/v1/reports/".concat(e,"/generate")},download:function(e){return"/api/v1/reports/".concat(e,"/download")},delete:function(e){return"/api/v1/reports/".concat(e)}}}},38:function(e,t,s){"use strict";var a=s(12),o={props:["customer","user","type","month"],data:function(){return{isSending:!1,sendAll:!1,checklist:[{message:"",name:trans("Sending Overall Scores"),icon:"mdi-cube-send",status:"pending"},{message:"",name:trans("Sending Overall Document"),icon:"mdi-file-send",status:"pending"}],error_trigger:!1,dialog:!1,dialogInfo:!1,sendBothScoresAndFile:!1,resource:{data:{}}}},computed:{isOverall:function(){return"overall"==this.type},isOverallDashboard:function(){return"overall-report-dashboard"==this.type}},methods:{sendAllScoresAndDocuments:function(){this.dialog=!0,this.sendAll=!0,this.checklist=this.checklist.map((function(e){return Object.assign(e,{status:"pending",message:""})})),this.sendToCrm()},getReportData:function(){var e=this;return new Promise((function(t,s){var a=e.customer,o=e.user,n=e.month;axios.get("/api/v1/reports/overall/customer/".concat(a,"/user/").concat(o,"?month=").concat(n)).then((function(e){t(e)})).catch((function(e){s(e)}))}))},getElements:function(){console.log(this.resource.data);var e=this.resource.data.report.value||{},t={};if(this.isOverall||this.isOverallDashboard)for(var s=_.map(e.indices,(function(e,t){return e.elements})),a=s.length-1;a>=0;a--){var o=s[a];t=Object.assign(t,o,{OverallScore:100*e["overall:score"],SustainabilityOverallScore:e.indices.BSPI["overall:total"]/100,FinancialOverallScore:e.indices.FMPI["overall:total"]/100,ProductivityOverallScore:e.indices.PMPI["overall:total"]/100,HROverallScore:e.indices.HRPI["overall:total"]/100})}else t=e["current:index"].elements;t=_.mapKeys(t,(function(e,t){return t.replace(/[^a-zA-Z]/g,"")})),t=_.mapKeys(t,(function(e,t){return t.replace(/\s+/g,"")})),(t=_.mapValues(t,(function(e,t){return 100*e}))).EmployeeEngagement=t.EmployeeEngagementCommunication||0,t.CareerManagement=t.CareerTalentManagement||0;var n=e["overall:enablers"].chart.data,r=e["overall:enablers"].chart.label;for(a=n.length-1;a>=0;a--){var i=n[a];t[r[a]]=i||0}return t.WorkflowProcesses=t["Workflow Processess"]||"",t},getOverallScore:function(){var e=this.resource.data.report.value["current:index"]["overall:total"],t="OverallScore";switch(this.resource.data.report.value["current:index"]["pindex:code"]){case"FMPI":t="Financial"+t;break;case"PMPI":t="Productivity"+t;break;case"HRPI":t="HR"+t;break;case"BSPI":t="Sustainability"+t}var s={};return s[t]=e,s},sendToCrm:function(){var e=this;this.isSending=!0,this.checklist[0].status="sending",this.$store.dispatch("snackbar/show",{button:{show:!1},timeout:0,text:"Sending report to CRM. Please wait..."}),this.getReportData().then((function(t){if(e.resource.data=t.data,!e.resource.data.customer)return e.$store.dispatch("snackbar/show",{text:"No report data found."}),!1;var s=Object.assign(e.getOverallScore(),e.getElements(),{Id:_.toUpper(e.resource.data.customer.token),FileNo:e.resource.data.customer.filenumber,Status:100000006,OverallScore:100*e.resource.data.report.value["overall:score"]||null,Comments:e.resource.data["overall:comment"]||"No comment",OverallComment:e.resource.data.report.value["overall:comment"]||null,"Lessons Learnt":e.resource.data.report.value["overall:comment"]||null});e.$store.dispatch("snackbar/show",{icon:"mdi-spin mdi-loading",button:{show:!1},timeout:0,text:"Sending report to CRM. Establishing connection to CRM..."}),console.log("Sending overall scores...",s),axios.post("/api/v1/crm/customers/save",s).then((function(t){e.$store.dispatch("snackbar/hide"),e.checklist[0].status="done",1==t.data.Code?e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Successfully sent to CRM")}):(e.checklist[0].status="error",e.checklist[0].message=t.data.Message,e.error_trigger=!0),e.sendBothScoresAndFile})).catch((function(t){e.checklist[0].status="error",e.checklist[0].message=t.message,e.error_trigger=!0,e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Unable to connect to CRM. Please check your network connection")})})).finally((function(){e.isSending=!1,e.sendAll&&e.sendDocumentToCrm()}))})).catch((function(e){console.log("err",e)}))},sendDocumentToCrm:function(){var e=this;this.isSending=!0,this.checklist[1].status="sending",this.getReportData().then((function(t){e.resource.data=t.data;var s={Id:_.toUpper(e.resource.data.customer.token),FileName:"Overall Scores",FileContentBase64:e.resource.data["overall:report"]||"empty"};console.log("Sending overall document...",s),e.$store.dispatch("snackbar/show",{icon:"mdi-spin mdi-loading",button:{show:!1},timeout:0,text:"Sending Overall Report Document to CRM. Establishing connection to CRM..."}),axios.post(a.a.crm.sendDocument(),s).then((function(t){e.$store.dispatch("snackbar/hide"),e.checklist[1].status="done",1==t.data.Code?e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("File Successfully sent to CRM")}):(e.checklist[1].status="error",e.checklist[1].message=t.data.Message,e.error_trigger=!0)})).catch((function(t){e.checklist[1].status="error",e.checklist[1].message=t.message,e.error_trigger=!0,e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Unable to connect to CRM. Please check your network connection")})})).finally((function(){e.isSending=!1}))}))},sendBothDataToCrm:function(){this.sendBothScoresAndFile=!0,this.sendToCrm()},sendFinancialScores:function(){var e=this;this.checklist[2].status="sending",this.$store.dispatch("snackbar/show",{button:{show:!1},timeout:0,text:"Sending report to CRM. Please wait..."}),this.getReportData().then((function(t){if(e.resource.data=t.data,console.log(e.resource.data),!e.resource.data.customer)return e.$store.dispatch("snackbar/show",{text:"No report data found."}),!1;var s={FileNo:e.resource.data.customer.filenumber,YearofFinancial:e.resource.data.customer.metadata?e.resource.data.customer.metadata.years.Years.Year3:"No year was set",SubmissionDate:e.resource.data.profit_and_loss["Submission Date"]||e.resource.data.report.updated_at,Revenue:parseInt(e.resource.data.profit_and_loss.Revenue.Year3||0),CostofGoodsSold:parseInt(e.resource.data.profit_and_loss.CostOfGoodsSold.Year3||0),OtherExpenses:parseInt(e.resource.data.profit_and_loss.OtherExpenses.Year3||0),NonOperatingExpenses:parseInt(e.resource.data.profit_and_loss.OtherExpenses["Non-Operating expenses (NOE)"].Year3||0),OperatingLossProfit:parseInt(e.resource.data.profit_and_loss.OtherExpenses["Operating (loss)/profit"].Year3||0),Depreciation:parseInt(e.resource.data.profit_and_loss.OtherExpenses.Depreciation.Year3||0),Taxes:parseInt(e.resource.data.profit_and_loss.OtherExpenses.Taxes.Year3||0),NetLossProfits:parseInt(e.resource.data.profit_and_loss.NetProfit.Year3||0),FixedAssets:parseInt(e.resource.data.profit_and_loss.FixedAssets["Fixed Assets"].Year3||0),TotalLiabilities:parseInt(e.resource.data.profit_and_loss.FixedAssets["Total Liabilities"].Year3||0),StockholdersEquity:parseInt(e.resource.data.profit_and_loss.FixedAssets["Stockholders' Equity"].Year3||0),Marketing:parseInt(e.resource.data.profit_and_loss.Marketing.Year3||0),Rent:parseInt(e.resource.data.profit_and_loss.Rent.Year3||0),Salaries:parseInt(e.resource.data.profit_and_loss.Salaries.Year3||0),LicensingFees:parseInt(e.resource.data.profit_and_loss["Licensing Fees"].Year3||0),VisaEmploymentFees:parseInt(e.resource.data.profit_and_loss["Visa / Employment Fees"].Year3||0)};console.log("Sending financial scores...",s),e.$store.dispatch("snackbar/show",{icon:"mdi-spin mdi-loading",button:{show:!1},timeout:0,text:"Sending report to CRM. Establishing connection to CRM..."}),axios.post(a.a.crm.sendFinancial(),s).then((function(t){e.$store.dispatch("snackbar/hide"),e.checklist[2].status="done",1==t.data.Code?e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Successfully sent to CRM")}):(e.checklist[2].status="error",e.checklist[2].message=t.data.Message)})).catch((function(t){e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Unable to connect to CRM. Please check your network connection")}),e.checklist[2].status="error"})).finally((function(){}))})).catch((function(e){console.log("err",e)}))},sendFinancialDocument:function(){var e=this;this.checklist[3].status="sending",this.getReportData().then((function(t){e.resource.data=t.data,console.log(e);var s={Id:_.toUpper(e.resource.data.customer.token),FileName:"Financial Ratios",FileContentBase64:e.resource.data["report:financial"]||"empty"};console.log("Sending financial document...",s),e.$store.dispatch("snackbar/show",{icon:"mdi-spin mdi-loading",button:{show:!1},timeout:0,text:"Sending Financial Report Document to CRM. Establishing connection..."}),axios.post(a.a.crm.sendDocument(),s).then((function(t){console.log("data",t.data),e.$store.dispatch("snackbar/hide"),e.checklist[3].status="done",1==t.data.Code?e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("File Successfully sent to CRM")}):(e.checklist[3].status="error",e.checklist[3].message=t.data.Message)})).catch((function(t){e.checklist[3].status="error",e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Unable to connect to CRM. Please check your network connection")})})).finally((function(){}))}))},dialogInfoClick:function(){this.dialogInfo=!0},dialogClose:function(){this.dialog=!1,this.error_trigger=!1}}},n=s(0),r=s(2),i=s.n(r),c=s(104),l=s(262),d=s(1),u=s(581),p=s(584),v=s(91),h=s(266),m=s(106),f=s(267),g=s(14),b=s(261),k=s(582),C=s(583),x=Object(n.a)(o,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isOverall?s("div",[s("v-btn",{attrs:{loading:e.isSending,disabled:e.isSending,large:"",block:e.$vuetify.breakpoint.smAndDown,color:"primary"},on:{click:e.sendAllScoresAndDocuments}},[s("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-send")]),e._v("\n    "+e._s(e.trans("Send to CRM"))+"\n  ")],1),e._v(" "),s("v-dialog",{attrs:{"max-width":"420",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-list",e._l(e.checklist,(function(t,a){return s("v-list-item",{key:a,attrs:{title:t.message}},[s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.name)}})],1),e._v(" "),s("v-list-item-action",["pending"==t.status?s("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-checkbox-blank-circle-outline")]):"sending"==t.status?s("v-progress-circular",{attrs:{indeterminate:"",width:"2",size:"12"}}):"done"==t.status?s("v-icon",{attrs:{small:"",left:"",color:"success"}},[e._v("mdi-check")]):"error"==t.status?s("div",[s("v-icon",{attrs:{small:"",left:"",color:"error"}},[e._v("mdi-alert-circle")])],1):e._e()],1)],1)})),1),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{attrs:{depressed:""},on:{click:e.dialogClose}},[e._v("Close")])],1),e._v(" "),s("v-spacer"),e._v(" "),e.error_trigger?s("v-container",{staticClass:"container py-6 px-auto"},[s("v-row",{attrs:{align:"center",justify:"center"}},[s("v-btn",{attrs:{large:"",color:"primary",dark:"",text:""},on:{click:e.dialogInfoClick}},[e._v("What Happened?\n          ")])],1)],1):e._e()],1)],1),e._v(" "),s("v-dialog",{attrs:{width:"800"},model:{value:e.dialogInfo,callback:function(t){e.dialogInfo=t},expression:"dialogInfo"}},[s("v-card",[s("v-card-title",[s("span",{staticClass:"text-h5"},[e._v("What Happened?")])]),e._v(" "),s("v-card-text",[s("p",{staticClass:"text-justify"},[s("b",[e._v("What happened:")]),e._v("\n            The Overall Score and Document of Hanzo Restaurant Company failed to send from the BEST application (SME) to KFED's CRM.\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("p",{staticClass:"text-justify"},[s("b",[e._v("How it happened:")]),e._v("\n              The CRM refused to receive the data from BEST. The exact response is Approved Site Visit with this Id does not exist.\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("p",{staticClass:"text-justify"},[s("b",[e._v("Why it happened:")])]),e._v(" "),s("v-spacer"),e._v(" "),s("p",{staticClass:"text-justify"},[s("b",[e._v(" These are the possible reasons why there is an error when sending data from BEST application (SME) to CRM: ")]),e._v("\n              The company no longer exists on the CRM. It could be deleted, modified, or updated.\n              If the company is listed in CRM, the company ID recorded in BEST and CRM may be different.\n              The company's status on the CRM is not on Approved Site Visit which is, perhaps, closed to receive data from BEST.\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("p",[s("b",[e._v("How to proceed:")]),e._v("\n              Please check the following on the CRM:\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("ol"),e._v(" "),s("p",[s("b",[e._v("Check if the ID exists.")]),e._v("\n                Try to send overall scores\n                If it exists and fails to proceed,  try to update the company into the BEST app under Find Company\n                  Search the Hanzo Restaurant and click start\n                    Try to send overall scores.\n          ")])],1),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{attrs:{depressed:""},on:{click:function(t){e.dialogInfo=!1}}},[e._v("Close")])],1)],1)],1)],1):e.isOverallDashboard?s("v-btn",{attrs:{icon:""},on:{click:e.sendAllScoresAndDocuments}},[s("v-icon",{attrs:{small:""}},[e._v("mdi-send")]),e._v(" "),s("v-dialog",{attrs:{"max-width":"420",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-list",{staticClass:"d-flex flex-md-wrap"},e._l(e.checklist,(function(t,a){return s("v-list-item",{key:a,attrs:{title:t.message,"two-line":""}},[s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.name)}}),e._v(" "),"error"==t.status?s("div",[s("v-list-item-subtitle",{staticClass:"align-self-start"},[s("span",{staticClass:"red--text",domProps:{textContent:e._s(t.message)}})])],1):e._e()],1),e._v(" "),s("v-list-item-action",["pending"==t.status?s("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-checkbox-blank-circle-outline")]):"sending"==t.status?s("v-progress-circular",{attrs:{indeterminate:"",width:"2",size:"12"}}):"done"==t.status?s("v-icon",{attrs:{small:"",left:"",color:"success"}},[e._v("mdi-check")]):"error"==t.status?s("div",[s("v-icon",{attrs:{small:"",left:"",color:"error"}},[e._v("mdi-alert-circle")])],1):e._e()],1)],1)})),1),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{attrs:{depressed:""},on:{click:e.dialogClose}},[e._v("Close")])],1),e._v(" "),s("v-spacer"),e._v(" "),e.error_trigger?s("v-container",{staticClass:"container py-6 px-auto"},[s("v-row",{attrs:{align:"center",justify:"center"}},[s("v-btn",{attrs:{large:"",color:"primary",dark:"",text:""},on:{click:e.dialogInfoClick}},[e._v("What Happened?\n          ")])],1)],1):e._e(),e._v(" "),s("v-spacer")],1)],1),e._v(" "),s("v-dialog",{attrs:{width:"800"},model:{value:e.dialogInfo,callback:function(t){e.dialogInfo=t},expression:"dialogInfo"}},[s("v-card",[s("v-card-title",[s("span",{staticClass:"text-h5"},[e._v("What Happened?")])]),e._v(" "),s("v-card-text",[s("p",{staticClass:"text-justify"},[s("b",[e._v("What happened:")]),e._v("\n            The Overall Score and Document of Hanzo Restaurant Company failed to send from the BEST application (SME) to KFED's CRM.\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("p",{staticClass:"text-justify"},[s("b",[e._v("How it happened:")]),e._v("\n              The CRM refused to receive the data from BEST. The exact response is Approved Site Visit with this Id does not exist.\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("p",{staticClass:"text-justify"},[s("b",[e._v("Why it happened:")])]),e._v(" "),s("v-spacer"),e._v(" "),s("p",{staticClass:"text-justify"},[s("b",[e._v(" These are the possible reasons why there is an error when sending data from BEST application (SME) to CRM: ")]),e._v("\n              The company no longer exists on the CRM. It could be deleted, modified, or updated.\n              If the company is listed in CRM, the company ID recorded in BEST and CRM may be different.\n              The company's status on the CRM is not on Approved Site Visit which is, perhaps, closed to receive data from BEST.\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("p",[s("b",[e._v("How to proceed:")]),e._v("\n              Please check the following on the CRM:\n          ")]),e._v(" "),s("v-spacer"),e._v(" "),s("ol"),e._v(" "),s("p",[s("b",[e._v("Check if the ID exists.")]),e._v("\n                Try to send overall scores\n                If it exists and fails to proceed,  try to update the company into the BEST app under Find Company\n                  Search the Hanzo Restaurant and click start\n                    Try to send overall scores.\n          ")])],1),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{attrs:{depressed:""},on:{click:function(t){e.dialogInfo=!1}}},[e._v("Close")])],1)],1)],1)],1):s("v-btn",{attrs:{icon:""},on:{click:e.sendToCrm}},[s("v-icon",{attrs:{small:""}},[e._v("mdi-send")])],1)}),[],!1,null,null,null);t.a=x.exports;i()(x,{VBtn:c.a,VCard:l.a,VCardActions:d.a,VCardText:d.c,VCardTitle:d.d,VContainer:u.a,VDialog:p.a,VIcon:v.a,VList:h.a,VListItem:m.a,VListItemAction:f.a,VListItemContent:g.a,VListItemSubtitle:g.b,VListItemTitle:g.c,VProgressCircular:b.a,VRow:k.a,VSpacer:C.a})}}]);
//# sourceMappingURL=0.js.map
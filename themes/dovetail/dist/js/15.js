(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{12:function(e,t,r){"use strict";t.a={list:function(){return"/api/v1/customers"},owned:function(){return"/api/v1/customers/owned"},store:function(){return"/api/v1/customers"},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/".concat(e)},restore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/restore/".concat(e)},update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/".concat(e)},trashed:function(){return"/api/v1/customers/trashed"},destroy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/".concat(e)},delete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"/api/v1/customers/delete/".concat(e)},overall:function(e,t){return"/api/v1/reports/overall/customer/".concat(e,"/user/").concat(t)},indices:{list:function(){return"/api/v1/indices"}},surveys:{submit:function(e){return"/api/v1/surveys/".concat(e,"/submit")},show:function(e){return"/api/v1/surveys/".concat(e)}},crm:{search:function(e){return"/api/v1/crm/customers/search/".concat(e)},update:function(){return"/api/v1/crm/customers/update"},save:function(){return"/api/v1/crm/customers/save"},sendDocument:function(){return"/api/v1/crm/report/send"},sendFinancial:function(){return"/api/v1/crm/financial/send"}},reports:{list:function(e){return"/api/v1/customers/".concat(e,"/reports")},generate:function(e){return"/api/v1/reports/".concat(e,"/generate")},download:function(e){return"/api/v1/reports/".concat(e,"/download")},delete:function(e){return"/api/v1/reports/".concat(e)}}}},296:function(e,t,r){"use strict";r.r(t);var o=r(9),n=r(12),a={components:{SendReportToCrmButton:r(38).a},computed:{isInEnglish:function(){return"en"==this.resource.lang}},data:function(){return{api:n.a,resource:{lang:window.localStorage.getItem("report:lang")||"en",loading:!1,data:{report:{month:""}}},url:null}},methods:{getReportData:function(){var e=this,t=this.$route.params.id,r=this.$route.query.user_id||o.default.getId();axios.get(n.a.overall(t,r)).then((function(t){e.resource.data=t.data}))},getReport:function(){var e=this.$route.query.user_id||o.default.getId(),t=this.$route.params.id,r=this.$route.query.lang||this.resource.lang,n=Object.assign({},this.$route.query,{lang:r});this.$router.replace({query:n}).catch((function(e){})),this.url="/best/preview/reports/overall?user_id=".concat(e,"&customer_id=").concat(t,"&lang=").concat(r)},previewPDFOverallReport:function(e){var t=this.$route.query.lang||this.resource.lang;window.open("/best/reports/pdf/preview/overall?user=".concat(e.user_id,"&customer=").concat(e.customer_id,"&month=").concat(e.month,"&lang=").concat(t),"_blank")},sendToCrm:function(e){var t={Id:this.resource.data.token,FileNo:this.resource.data.refnum,OverallScore:e.value["overall:score"],FileContentBase64:e.fileContentBase64,"Lessons Learnt":e.value["overall:comment"]};axios.post(n.a.crm.save(),t).then((function(e){console.log(e)}))},downloadReport:function(){window.location.href="/reports/".concat(this.$route.params.report,"/download")},setIframeHeight:function(){this.resource.loading=!0,document.querySelector("iframe").addEventListener("load",(function(e){var t=this.contentWindow||this.contentDocument.parentWindow;t.document.body&&(this.height=t.document.documentElement.scrollHeight||t.document.body.scrollHeight)})),this.resource.loading=!1},goToShowPage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en";window.localStorage.setItem("report:lang",e),this.resource.lang=e,this.$router.push({name:"reports.overall",params:{id:this.$route.params.id,report:this.$route.params.report},query:{lang:e,type:"overall"}}).catch((function(e){})),this.$router.go()}},mounted:function(){this.setIframeHeight(),this.getReportData(),this.getReport()}},s=r(0),c=r(2),i=r.n(c),u=r(260),l=r(91),d=Object(s.a)(a,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("admin",[r("metatag",{attrs:{title:e.trans("Overall Report")}}),e._v(" "),r("page-header",{attrs:{back:{to:{name:"companies.reports"},text:e.trans("Back to Reports")}},scopedSlots:e._u([{key:"utilities",fn:function(){return[r("div",{staticClass:"mb-2"},[e.resource.data.report?r("a",{staticClass:"dt-link text--decoration-none mr-4",on:{click:function(t){return t.preventDefault(),e.previewPDFOverallReport(e.resource.data.report)}}},[r("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-file-pdf")]),e._v("\n          "+e._s(e.trans("Preview PDF Report"))+"\n        ")],1):e._e()]),e._v(" "),r("can",{attrs:{code:"reports.comment"}},[r("add-overall-comment",{attrs:{month:e.resource.data.report.month},on:{"update:month":function(t){return e.$set(e.resource.data.report,"month",t)}}})],1)]},proxy:!0},{key:"action",fn:function(){return[r("div",{staticClass:"mb-3"},[e.resource.data.customer&&e.isInEnglish?r("div",[r("send-report-to-crm-button",{attrs:{type:"overall","with-file":"",customer:e.resource.data.customer.id,user:e.resource.data.report.user_id}})],1):e._e()]),e._v(" "),"en"==e.resource.lang?r("a",{staticClass:"dt-link text--decoration-none mr-4",on:{click:function(t){return e.goToShowPage("ar")}}},[r("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-earth")]),e._v("\n        "+e._s(e.trans("View Report in Arabic"))+"\n      ")],1):r("a",{staticClass:"dt-link text--decoration-none mr-4",on:{click:function(t){return e.goToShowPage("en")}}},[r("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-earth")]),e._v("\n        "+e._s(e.trans("View Report in English"))+"\n      ")],1)]},proxy:!0}])}),e._v(" "),[r("v-card",{attrs:{outlined:""}},[r("iframe",{attrs:{width:"100%",id:"iframe-preview",src:e.url,frameborder:"0"}})])]],2)}),[],!1,null,null,null);t.default=d.exports;i()(d,{VCard:u.a,VIcon:l.a})},38:function(e,t,r){"use strict";var o=r(12),n={props:["customer","user","type"],data:function(){return{isSending:!1,sendBothScoresAndFile:!1,resource:{data:{}}}},computed:{isOverall:function(){return"overall"==this.type}},methods:{getReportData:function(){var e=this;return new Promise((function(t,r){var o=e.customer,n=e.user;axios.get("/api/v1/reports/overall/customer/".concat(o,"/user/").concat(n)).then((function(e){t(e)})).catch((function(e){r(e)}))}))},getElements:function(){console.log(this.resource.data);var e=this.resource.data.report.value||{},t={};if(this.isOverall)for(var r=_.map(e.indices,(function(e,t){return e.elements})),o=r.length-1;o>=0;o--){var n=r[o];t=Object.assign(t,n,{OverallScore:100*e["overall:score"],SustainabilityOverallScore:e.indices.BSPI["overall:total"]/100,FinancialOverallScore:e.indices.FMPI["overall:total"]/100,ProductivityOverallScore:e.indices.PMPI["overall:total"]/100,HROverallScore:e.indices.HRPI["overall:total"]/100})}else t=e["current:index"].elements;t=_.mapKeys(t,(function(e,t){return t.replace(/[^a-zA-Z]/g,"")})),t=_.mapKeys(t,(function(e,t){return t.replace(/\s+/g,"")})),(t=_.mapValues(t,(function(e,t){return 100*e}))).EmployeeEngagement=t.EmployeeEngagementCommunication||0,t.CareerManagement=t.CareerTalentManagement||0;var a=e["overall:enablers"].chart.data,s=e["overall:enablers"].chart.label;for(o=a.length-1;o>=0;o--){var c=a[o];t[s[o]]=c||0}return t.WorkflowProcesses=t["Workflow Processess"]||"",t},getOverallScore:function(){var e=this.resource.data.report.value["current:index"]["overall:total"],t="OverallScore";switch(this.resource.data.report.value["current:index"]["pindex:code"]){case"FMPI":t="Financial"+t;break;case"PMPI":t="Productivity"+t;break;case"HRPI":t="HR"+t;break;case"BSPI":t="Sustainability"+t}var r={};return r[t]=e,r},sendToCrm:function(){var e=this;this.isSending=!0,this.$store.dispatch("snackbar/show",{button:{show:!1},timeout:0,text:"Sending report to CRM. Please wait..."}),this.getReportData().then((function(t){if(e.resource.data=t.data,!e.resource.data.customer)return e.$store.dispatch("snackbar/show",{text:"No report data found."}),!1;var r=Object.assign(e.getOverallScore(),e.getElements(),{Id:_.toUpper(e.resource.data.customer.token),FileNo:e.resource.data.customer.filenumber,Status:100000006,OverallScore:100*e.resource.data.report.value["overall:score"]||null,Comments:e.resource.data["overall:comment"]||"No comment",OverallComment:e.resource.data.report.value["overall:comment"]||null,"Lessons Learnt":e.resource.data.report.value["overall:comment"]||null});e.$store.dispatch("snackbar/show",{icon:"mdi-spin mdi-loading",button:{show:!1},timeout:0,text:"Sending report to CRM. Establishing connection to CRM..."}),console.log("DATA",r),axios.post("/api/v1/crm/customers/save",r).then((function(t){e.$store.dispatch("snackbar/hide"),1==t.data.Code?e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Successfully sent to CRM")}):e.$store.dispatch("dialog/error",{show:!0,width:400,buttons:{cancel:{show:!1}},title:"Returned a Code "+t.data.Code,text:t.data.Message}),e.sendBothScoresAndFile&&(console.log("sending file..."),e.sendDocumentToCrm())})).catch((function(t){e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Unable to connect to CRM. Please check your network connection")})})).finally((function(){e.isSending=!1}))})).catch((function(e){console.log("err",e)}))},sendDocumentToCrm:function(){var e=this;this.isSending=!0,this.getReportData().then((function(t){e.resource.data=t.data;var r={Id:_.toUpper(e.resource.data.customer.token),FileContentBase64:e.resource.data["overall:report"]||"empty"};e.$store.dispatch("snackbar/show",{icon:"mdi-spin mdi-loading",button:{show:!1},timeout:0,text:"Sending Overall Report Document to CRM. Establishing connection to CRM..."}),axios.post(o.a.crm.sendDocument(),r).then((function(t){console.log("asdasd",t.data),e.$store.dispatch("snackbar/hide"),1==t.data.Code?e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("File Successfully sent to CRM")}):e.$store.dispatch("dialog/error",{show:!0,width:400,buttons:{cancel:{show:!1}},title:"Returned a Code "+t.data.Code,text:t.data.Message})})).catch((function(t){e.$store.dispatch("snackbar/show",{icon:!1,timeout:8e3,button:{show:!0},text:trans("Unable to connect to CRM. Please check your network connection")})})).finally((function(){e.isSending=!1}))}))},sendBothDataToCrm:function(){console.log("sending both scores + file..."),this.sendBothScoresAndFile=!0,this.sendToCrm()}}},a=r(0),s=r(2),c=r.n(s),i=r(105),u=r(91),l=Object(a.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isOverall?r("div",[r("v-btn",{attrs:{loading:e.isSending,disabled:e.isSending,large:"",block:e.$vuetify.breakpoint.smAndDown,color:"primary"},on:{click:e.sendBothDataToCrm}},[r("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-send")]),e._v("\n    "+e._s(e.trans("Send Scores to CRM"))+"\n  ")],1)],1):r("v-btn",{attrs:{icon:""},on:{click:e.sendToCrm}},[r("v-icon",{attrs:{small:""}},[e._v("mdi-send")])],1)}),[],!1,null,null,null);t.a=l.exports;c()(l,{VBtn:i.a,VIcon:u.a})}}]);
//# sourceMappingURL=15.js.map